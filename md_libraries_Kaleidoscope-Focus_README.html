<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kaleidoscope: Kaleidoscope-Focus</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kaleidoscope
   </div>
   <div id="projectbrief">Customizable firmware for keyboards</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Kaleidoscope-Focus </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://img.shields.io/badge/experimental----black.svg?style=flat&colorA=dfb317&colorB=494e52"  alt="status"/>
</div>
<p> <a href="https://travis-ci.org/keyboardio/Kaleidoscope-Focus">![Build Status][travis:image]</a></p>
<p>Bidirectional communication for Kaleidoscope. With this plugin, one can expose a set of commands via the Serial port, and allow the host to talk with the keyboard - and vice versa. This plugin implements only the basic building blocks, a framework other plugins can opt-in to.</p>
<h2>Using the plugin</h2>
<p>This plugin is <b>not</b> meant to be used by the end-user (apart from setting it up to use plugin-provided hooks), but by plugin authors instead. As an end user, please see the documentation of the plugins you use, for instructions on how to hook them up with <code>Focus</code>!</p>
<p>Nevertheless, the basic commands we implement with this plugin alone, are usable like this:</p>
<p>```c++ #include &lt;<a class="el" href="Kaleidoscope_8h_source.html">Kaleidoscope.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-Focus_8h_source.html">Kaleidoscope-Focus.h</a>&gt;</p>
<p>void setup () { Serial.begin (9600);</p>
<p>Kaleidoscope.use (&amp;Focus);</p>
<p>Kaleidoscope.setup ();</p>
<p>Focus.addHook (FOCUS_HOOK_HELP); Focus.addHook (FOCUS_HOOK_VERSION); } ```</p>
<h2>Plugin methods</h2>
<p>The plugin provides the <code>Focus</code> object, which has the following method:</p>
<h3><code>.addHook(FOCUS_HOOK (function, documentation))</code></h3>
<blockquote class="doxtable">
<p>Adds a new hook to <code>Focus</code>. Hooks are called in order of registration, and they get the parsed command name as argument. If they handle the command, they shall return <code>true</code>, otherwise <code>false</code>. Once a command has been handled, it will not be given to other hooks.</p>
<p>The hook function is responsible for reading the rest of the command, in whatever way it sees fit.</p>
<p>The <code>documentation</code> argument is a string, used by the <code>help</code> command, and can be left empty, if no documentation is desired for the <code>function</code>.</p>
<p></p>
</blockquote>
<h2>Focus commands</h2>
<p>The plugin ships with two (optional) hooks: <code>FOCUS_HOOK_VERSION</code>, and <code>FOCUS_HOOK_HELP</code>, implementing the following two commands, respectively:</p>
<h3><code>version</code></h3>
<blockquote class="doxtable">
<p>Return the version of the firmware, the keyboard vendor &amp; product, and the compile date.</p>
<p></p>
</blockquote>
<h3><code>help</code></h3>
<blockquote class="doxtable">
<p>Return the list of commands the keyboard supports.</p>
<p></p>
</blockquote>
<h2>Wire protocol</h2>
<p><code>Focus</code> uses a simple, textual, request-response-based wire protocol.</p>
<p>Each request has to be on one line, anything before the first space is the command part (if there is no space, just a newline, then the whole line will be considered a command), everything after are arguments. The plugin itself only parses until the end of the command part, argument parsing is left to the various hooks. If there is anything left on the line after hooks are done processing, it will be ignored.</p>
<p>Responses can be multi-line, but most aren't. Their content is also up to the hooks, <code>Focus</code> does not enforce anything, except a trailing dot and a newline. Responses should end with a dot on its own line.</p>
<p>Apart from these, there are no restrictions on what can go over the wire, but to make the experience consistent, find a few guidelines below:</p>
<ul>
<li>Commands should be namespaced, so that the plugin name, or functionality comes first, then the sub-command or property. Such as <code>led.theme</code>, or <code>led.setAll</code>.</li>
<li>One should not use setters and getters, but a single property command instead. One, which when called without arguments, will act as a getter, and as a setter otherwise.</li>
<li>Namespaces should be lowercase, while the commands within them camel-case.</li>
<li>Do as little work in the hooks as possible. While the protocol is human readable, the expectation is that tools will be used to interact with the keyboard.</li>
<li>As such, keep formatting to the bare minimum. No fancy table-like responses.</li>
<li>In general, the output of a getter should be copy-pasteable to a setter.</li>
</ul>
<p>These are merely guidelines, and there can be - and are - exceptions. Use your discretion when writing Focus hooks.</p>
<h3>Example</h3>
<p>In the examples below, <code>&lt;</code> denotes what the host sends to the keyboard, <code>&gt;</code> what the keyboard responds.</p>
<p>``` &lt; version </p>
<blockquote class="doxtable">
<p>Kaleidoscope/locally-built Keyboardio/Model 01 | Jun 14 2017 11:22:19 </p>
</blockquote>
<p>```</p>
<p>``` &lt; help </p>
<blockquote class="doxtable">
<p>help version </p>
</blockquote>
<p>```</p>
<p>``` &lt; palette </p>
<blockquote class="doxtable">
<p>0 0 0 128 128 128 255 255 255 </p>
</blockquote>
<p>&lt; palette 0 0 0 128 128 128 255 255 255 </p>
<blockquote class="doxtable">
<p></p>
</blockquote>
<p>```</p>
<h2>Further reading</h2>
<p>Starting from the <a href="https://github.com/keyboardio/Kaleidoscope-Focus/blob/master/examples/Focus/Focus.ino">example</a> is the recommended way of getting started with the plugin. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
