<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kaleidoscope: Kaleidoscope-Macros</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kaleidoscope
   </div>
   <div id="projectbrief">Customizable firmware for keyboards</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Kaleidoscope-Macros </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://img.shields.io/badge/stable-âœ”-black.svg?style=flat&colorA=44cc11&colorB=494e52"  alt="status"/>
</div>
<p> <a href="https://travis-ci.org/keyboardio/Kaleidoscope-Macros">![Build Status][travis:image]</a></p>
<p>Macros are a standard feature on many keyboards and Kaleidoscope-powered ones are no exceptions. Macros are a way to have a single key-press do a whole lot of things under the hood: conventionally, macros play back a key sequence, but with Kaleidoscope, there is much more we can do. Nevertheless, playing back a sequence of events is still the primary use of macros.</p>
<p>Playing back a sequence means that when we press a macro key, we can have it play pretty much any sequence. It can type some text for us, or invoke a complicated shortcut - the possibilities are endless!</p>
<h2>Using the plugin</h2>
<p>To use the plugin, we need to include the header, tell the firmware to <code>use</code> the plugin, place macros on the keymap, and create a special handler function (<code>macroAction</code>) that will tell the plugin what shall happen when macro keys are pressed. It is best illustrated with an example:</p>
<p>```c++ #include &lt;<a class="el" href="Kaleidoscope_8h_source.html">Kaleidoscope.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-Macros_8h_source.html">Kaleidoscope-Macros.h</a>&gt;</p>
<p>// Give a name to the macros! enum { MACRO_MODEL01, MACRO_HELLO, MACRO_SPECIAL, };</p>
<p>// Somewhere in the keymap: M(MACRO_MODEL01), M(MACRO_HELLO), M(MACRO_SPECIAL)</p>
<p>// later in the Sketch: const macro_t *macroAction(uint8_t macroIndex, uint8_t keyState) { switch (macroIndex) { case MACRO_MODEL01: return MACRODOWN(I(25), D(LeftShift), T(M), U(LeftShift), T(O), T(D), T(E), T(L), T(Spacebar), W(100), T(0), T(1) ); case MACRO_HELLO: if (keyToggledOn(keyState)) { return Macros.type(PSTR("Hello "), PSTR("world!")); } break; case MACRO_SPECIAL: if (keyToggledOn(keyState)) { // Do something special } break; } return MACRO_NONE; }</p>
<p>void setup() { Kaleidoscope.use(&amp;Macros);</p>
<p>Kaleidoscope.setup (); } ```</p>
<h2>Keymap markup</h2>
<h3><code>M(id)</code></h3>
<blockquote class="doxtable">
<p>Places a macro key on the keymap, with the <code>id</code> identifier. Whenever this key has to be handled, the <code>macroAction</code> overrideable function will be called, with the identifier and key state as arguments.</p>
<p>It is recommended to give a <em>name</em> to macros, by using an <code>enum</code>.</p>
<p></p>
</blockquote>
<h2>Plugin methods</h2>
<p>The plugin provides a <code>Macros</code> object, with the following methods and properties available:</p>
<h3><code>.play(macro)</code></h3>
<blockquote class="doxtable">
<p>Plays back a macro, where a macro is a sequence created with the <code>MACRO()</code> helper discussed below. This method will be used by the plugin to play back the result of the <code>macroAction()</code> method, but is used rarely otherwise.</p>
<p>The <code>macro</code> argument must be a sequence created with the <code>MACRO()</code> helper!</p>
<p></p>
</blockquote>
<h3><code>.type(strings...)</code></h3>
<blockquote class="doxtable">
<p>In cases where we only want to type some strings, it is far more convenient to use this method: we do not have to use the <code>MACRO()</code> helper, but just give this one a set of strings, and it will type them for us on the keyboard. We can use as many strings as we want, and all of them will be typed in order.</p>
<p>Each string is limited to a sequence of printable ASCII characters. No international symbols, or unicode, or anything like it: just plain ASCII.</p>
<p>Each of <code>strings</code> arguments must also reside in program memory, and the easiest way to do that is to wrap the string in a <code>PSTR()</code> helper. See the program code at the beginning of this documentation for an example!</p>
<p></p>
</blockquote>
<h3><code>.row</code>, <code>.col</code></h3>
<blockquote class="doxtable">
<p>The <code>row</code> and <code>col</code> properties describe the physical position a macro was triggered from if it was triggered by a key. The playback functions do not use these properties, but they are available, would one want to create a macro that needs to know which key triggered it.</p>
<p>When the macro was not triggered by a key the value of these properties are unspecified.</p>
<p></p>
</blockquote>
<h2>Macro helpers</h2>
<p>Macros need to be able to simulate key down and key up events for any key - even keys that may not be on the keymap otherwise. For this reason and others, we need to define them in a special way, using the <code>MACRO</code> helper (or its <code>MACRODOWN()</code> variant, see below):</p>
<h3><code>MACRO(steps...)</code></h3>
<blockquote class="doxtable">
<p>Defines a macro, that is built up from <code>steps</code> (explained below). The plugin will iterate through the sequence, and re-play the steps in order.</p>
<p>Note: In older versions of the Macros plugin, the sequence of steps had to end with a special step called END. This is no longer required. Existing macros that end with END will still work correctly, but new code should not use END; usage of END is deprecated.</p>
<p></p>
</blockquote>
<h3><code>MACRODOWN(steps...)</code></h3>
<blockquote class="doxtable">
<p>The same as the <code>MACRO()</code> helper above, but it will create a special sequence, where the steps are only played back when the triggering key was just pressed. That is, the macro will not be performed when the key is released, or held, or not pressed at all.</p>
<p>Use this over <code>MACRO()</code> when you only want to perform an action when the key actuates, and no action should be taken when it is held, released, or when it is not pressed at all. For a lot of macros that emit a sequence without any other side effects, <code>MACRODOWN()</code> is usually the better choice.</p>
<p>Can only be used from the <code>macroAction()</code> overrideable method.</p>
<p></p>
</blockquote>
<h2><code>MACRO</code> steps</h2>
<p>Macro steps can be divided into two groups:</p>
<h3>Delays</h3>
<ul>
<li><code>I(millis)</code>: Sets the interval between steps to <code>millis</code>. By default, there is no delay between steps, and they are played back as fast as possible. Useful when we want to see the macro being typed, or need to slow it down, to allow the host to process it.</li>
<li><code>W(millis)</code>: Waits for <code>millis</code> milliseconds. For dramatic effects.</li>
</ul>
<h3>Key events</h3>
<p>Key event steps have two variants: one that prefixes its argument with <code><a class="el" href="unionKey__.html">Key_</a></code>, and one that does not. The latter are the <code>Dr</code>, <code>Ur</code>, and <code>Tr</code> variants. In most cases, one is likely to use normal keys for the steps, so the <code>D</code>, <code>U</code>, and <code>T</code> steps apply the <code><a class="el" href="unionKey__.html">Key_</a></code> prefix. This allows us to write <code>MACRO(T(X))</code> instead of <code>MACRO(Tr(Key_X))</code> - making the macro definition shorter, and more readable.</p>
<ul>
<li><code>D(key)</code>, <code>Dr(key)</code>: Simulates a key being pressed (pushed down).</li>
<li><code>U(key)</code>, <code>Ur(key)</code>: Simulates a key being released (going up).</li>
<li><code>T(key)</code>, <code>Tr(key)</code>: Simulates a key being tapped (pressed first, then released).</li>
</ul>
<h2>Overrideable methods</h2>
<h3><code>macroAction(macroIndex, keyState)</code></h3>
<blockquote class="doxtable">
<p>The <code>macroAction</code> method is the brain of the macro support in Kaleidoscope: this function tells the plugin what sequence to play when given a macro index and a key state.</p>
<p>It should return a macro sequence, or <code>MACRO_NONE</code> if nothing is to be played back. </p>
</blockquote>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
