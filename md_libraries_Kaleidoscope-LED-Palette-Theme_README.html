<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kaleidoscope: Kaleidoscope-LED-Palette-Theme</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kaleidoscope
   </div>
   <div id="projectbrief">Customizable firmware for keyboards</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Kaleidoscope-LED-Palette-Theme </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://img.shields.io/badge/experimental----black.svg?style=flat&colorA=dfb317&colorB=494e52"  alt="status"/>
</div>
<p> <a href="https://travis-ci.org/keyboardio/Kaleidoscope-LED-Palette-Theme">![Build Status][travis:image]</a></p>
<p>A common base for plugins that want to provide themes, or theme-related capabilities, using a 16 color palette. In other words, this is for plugin authors primarily. The primary aim of the plugin is to provide not only a common palette, but tools that make it easier to use it too.</p>
<h2>Using the plugin</h2>
<p>To use the plugin, one needs to do a bit more than include the header, and tell the firmware to use it. Itself being a mere building block, to use it to its full extent, we need to create our own plugin on top of it.</p>
<p>```c++ #include &lt;<a class="el" href="Kaleidoscope_8h_source.html">Kaleidoscope.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-EEPROM-Settings_8h_source.html">Kaleidoscope-EEPROM-Settings.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-LED-Palette-Theme_8h_source.html">Kaleidoscope-LED-Palette-Theme.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-Focus_8h_source.html">Kaleidoscope-Focus.h</a>&gt;</p>
<p>namespace example {</p>
<p>class TestLEDMode : public LEDMode { public: TestLEDMode() {}</p>
<p>protected: void setup(void) final; void update(void) final;</p>
<p>static bool focusHook(const char *command);</p>
<p>private: static uint16_t map_base_; };</p>
<p>uint16_t TestLEDMode::map_base_;</p>
<p>void TestLEDMode::setup(void) { map_base_ = LEDPaletteTheme.reserveThemes(1); }</p>
<p>void TestLEDMode::update(void) { LEDPaletteTheme.updateHandler(map_base_, 0); }</p>
<p>bool TestLEDMode::focusHook(const char *command) { return LEDPaletteTheme.themeFocusHandler(command, PSTR("testLedMode.map"), map_base_, 1); }</p>
<p>}</p>
<p><a class="el" href="classexample_1_1TestLEDMode.html">example::TestLEDMode</a> TestLEDMode;</p>
<p>void setup() { Serial.begin(9600);</p>
<p>Kaleidoscope.use(&amp;Focus, &amp;LEDPaletteTheme, &amp;TestLEDMode, &amp;EEPROMSettings);</p>
<p>Kaleidoscope.setup();</p>
<p>EEPROMSettings.seal(); TestLEDMode.activate();</p>
<p>Focus.addHook(FOCUS_HOOK_LEDPALETTETHEME); Focus.addHook(FOCUS_HOOK(TestLEDMode.focusHook, "testLEDMode.map")); } ```</p>
<p>This is a simple extension, where it provides a <code>testLEDMode.map</code> Focus command, with which one can set the theme which will be saved to EEPROM.</p>
<h2>Plugin methods</h2>
<p>The plugin provides the <code>LEDPaletteTheme</code> object, which has the following methods and properties:</p>
<h3><code>.reserveThemes(max_themes)</code></h3>
<blockquote class="doxtable">
<p>Reserve space in EEPROM for <code>max_themes</code>. Each key on a theme uses half a byte of space. The function returns the <code>theme_base</code> to be used with the rest of the methods.</p>
<p>The <code>theme_base</code> is a pointer into the EEPROM where the theme storage starts.</p>
<p></p>
</blockquote>
<h3><code>.updateHandler(theme_base, theme)</code></h3>
<blockquote class="doxtable">
<p>A helper we can call in our plugin's <code>.update()</code> method: given an EEPROM location (<code>theme_base</code>), and a <code>theme</code> index, it will update the keyboard with the colors of the specified theme.</p>
<p>The <code>theme</code> argument can be any index between zero and <code>max_themes</code>. How the plugin decides which theme to display depends entirely on the plugin.</p>
<p></p>
</blockquote>
<h3><code>.themeFocusHandler(command, expected_command, theme_base, max_themes)</code></h3>
<blockquote class="doxtable">
<p>To be used in a custom <code>Focus</code> handler: handles the <code>expected_command</code> Focus command, and provides a way to query and update the themes supported by the plugin.</p>
<p>When queried, it will list the color indexes. When used as a setter, it expects one index per key.</p>
<p>The palette can be set via the <code>palette</code> focus command, implemented by the <code>FOCUS_HOOK_LEDPALETTETHEME</code> hook explained below.</p>
<p></p>
</blockquote>
<h2>Focus commands</h2>
<p>The plugin provides a single <code>Focus</code> hook, <code>FOCUS_HOOK_LEDPALETTETHEME</code>, implementing the following command:</p>
<h3><code>palette</code></h3>
<blockquote class="doxtable">
<p>Without arguments, prints the palette: RGB values for all 16 colors.</p>
<p>With arguments, updates the palette with new colors. One does not need to give the full palette, the plugin will process as many arguments as available, and ignore anything past the last index. It expects colors to have all three components specified, or none at all. Thus, partial palette updates are possible, but only on the color level, not at component level.</p>
<p></p>
</blockquote>
<h2>Dependencies</h2>
<ul>
<li><a href="https://github.com/keyboardio/Kaleidoscope-EEPROM-Settings">Kaleidoscope-EEPROM-Settings</a></li>
<li><a href="https://github.com/keyboardio/Kaleidoscope-Focus">Kaleidoscope-Focus</a></li>
<li><a href="https://github.com/keyboardio/Kaleidoscope-LEDControl">Kaleidoscope-LEDControl</a></li>
</ul>
<h2>Further reading</h2>
<p>Starting from the <a href="https://github.com/keyboardio/Kaleidoscope-LED-Palette-Theme/blob/master/examples/LED-Palette-Theme/LED-Palette-Theme.ino">example</a> is the recommended way of getting started with the plugin. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
