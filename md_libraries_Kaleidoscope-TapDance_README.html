<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kaleidoscope: Kaleidoscope-TapDance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kaleidoscope
   </div>
   <div id="projectbrief">Customizable firmware for keyboards</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Kaleidoscope-TapDance </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://img.shields.io/badge/stable-âœ”-black.svg?style=flat&colorA=44cc11&colorB=494e52"  alt="status"/>
</div>
<p> <a href="https://travis-ci.org/keyboardio/Kaleidoscope-TapDance">![Build Status][travis:image]</a></p>
<p>Tap-dance keys are general purpose, multi-use keys, which trigger a different action based on the number of times they were tapped in sequence. As an example to make this clearer, one can have a key that inputs <code>A</code> when tapped once, inputs <code>B</code> when tapped twice, and lights up the keyboard in Christmas colors when tapped a third time.</p>
<p>This behaviour is most useful in cases where we have a number of things we perform rarely, where tapping a single key repeatedly is not counter-productive. Such cases include - for example - multimedia forward / backward keys: forward on single tap, backward on double. Of course, one could use modifiers to achieve a similar effect, but that's two keys to use, this is only one. We can also hide some destructive functionality behind a number of taps: reset the keyboard after 4 taps, and light up LEDs in increasingly frightful colors until then.</p>
<h2>How does it work?</h2>
<p>To not interfere with normal typing, tap-dance keys have two ways to decide when to call an action: they either get interrupted, or they time out. Every time a tap-dance key is pressed, the timer resets, so one does not have to finish the whole tapping sequence within a short time limit. The tap-dance counter continues incrementing until one of these cases happen.</p>
<p>When a tap-dance key is pressed and released, and nothing is pressed on the keyboard until the timeout is reached, then the key will time out, and trigger an action. Which action, depends on the number of times it has been tapped up until this point.</p>
<p>When a tap-dance key is pressed and released, and another key is hit before the timer expires, then the tap-dance key will trigger an action first, perform it, and only then will the firmware continue handling the interrupting key press. This is to preserve the order of keys pressed.</p>
<p>In both of these cases, the <a href="#tapdanceactiontapdanceindex-tapcount-tapdanceaction">`tapDanceAction`</a> will be called, with <code>tapDanceIndex</code> set to the index of the tap-dance action (as set in the keymap), the <code>tapCount</code>, and <code>tapDanceAction</code> set to either <code>kaleidoscope::TapDance::Interrupt</code>, or <code>kaleidoscope::TapDance::Timeout</code>. If we continue holding the key, then as long as it is held, the same function will be called with <code>tapDanceAction</code> set to <code>kaleidoscope::TapDance::Hold</code>. When the key is released, after either an <code>Interrupt</code> or <code>Timeout</code> action was triggered, the function will be called with <code>tapDanceAction</code> set to <code>kaleidoscope::TapDance::Release</code>.</p>
<p>These actions allow us to create sophisticated tap-dance setups, where one can tap a key twice and hold it, and have it repeat, for example.</p>
<p>There is one additional value the <code>tapDanceAction</code> parameter can take: <code>kaleidoscope::TapDance::Tap</code>. It is called with this argument for each and every tap, even if no action is to be triggered yet. This is so that we can have a way to do some side-effects, like light up LEDs to show progress, and so on.</p>
<h2>Using the plugin</h2>
<p>To use the plugin, we need to include the header, and declare the behaviour used. Then, we need to place tap-dance keys on the keymap. And finally, we need to implement the <a href="#tapdanceactiontapdanceindex-tapcount-tapdanceaction">`tapDanceAction`</a> function that gets called each time an action is to be performed.</p>
<p>```c++ #include &lt;<a class="el" href="Kaleidoscope_8h_source.html">Kaleidoscope.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-TapDance_8h_source.html">Kaleidoscope-TapDance.h</a>&gt;</p>
<p>// Somewhere in the keymap: TD(0)</p>
<p>// later in the Sketch: void tapDanceAction(uint8_t tap_dance_index, byte row, byte col, uint8_t tap_count, kaleidoscope::TapDance::ActionType tap_dance_action) { switch (tap_dance_index) { case 0: return tapDanceActionKeys(tap_count, tap_dance_action, Consumer_ScanNextTrack, Consumer_ScanPreviousTrack); } }</p>
<p>void setup() { Kaleidoscope.use(&amp;TapDance);</p>
<p>Kaleidoscope.setup (); } ```</p>
<h2>Keymap markup</h2>
<h3><code>TD(id)</code></h3>
<blockquote class="doxtable">
<p>A key that acts as a tap-dance key. The actions performed depend on the implementation for the <code>id</code> index within the [<code>tapDanceActions</code>][tdactions] function.</p>
<p>The <code>id</code> parameter here is what will be used as <code>tap_dance_index</code> in the handler function.</p>
<p></p>
</blockquote>
<p>#</p>
<h1>Plugin methods</h1>
<p>The plugin provides a <code>TapDance</code> object, but to implement the actions, we need to define a function (<a href="#tapdanceactiontapdanceindex-tapcount-tapdanceaction">`tapDanceAction`</a>) outside of the object. A handler, of sorts. Nevertheless, the plugin provides one macro that is particularly useful: <code>tapDanceActionKeys</code>. Apart from that, it provides one property only:</p>
<h3><code>.time_out</code></h3>
<blockquote class="doxtable">
<p>The number of loop iterations to wait before a tap-dance sequence times out. Once the sequence timed out, the action for it will trigger, even without an interruptor. Defaults to 5, and the timer resets with every tap of the same</p>
<p></p>
</blockquote>
<h3><code>tapDanceActionKeys(tap_count, tap_dance_action, keys...)</code></h3>
<blockquote class="doxtable">
<p>Sets up an action where for each subsequent tap, a different key will be chosen from the list of keys supplied in the <code>keys...</code> argument.</p>
<p>If we have <code>Key_A</code> and <code>Key_B</code> in the list, then, if tapped once, this function will input <code>A</code>, but when tapped twice, will input <code>B</code>.</p>
<p>When all our actions are just different keys, this is a very handy macro to use.</p>
<p>The <code>tap_count</code> and <code>tap_dance_actions</code> parameters should be the same as the similarly named parameters of the <code>tapDanceAction</code> function.</p>
<p></p>
</blockquote>
<h3><code>tapDanceAction(tap_dance_index, row, col, tap_count, tap_dance_action)</code></h3>
<blockquote class="doxtable">
<p>The heart of the tap-dance plugin is the handler method. This is called every time any kind of tap-dance action is to be performed. See the *<a href="#how-does-it-work">How does it work?</a>* section for details about when and how this function is called.</p>
<p>The <code>tap_dance_index</code> and <code>tap_count</code> parameters help us choose which action to perform. The <code>row</code> and <code>col</code> parameters tell us where the tap-dance key is on the keyboard.</p>
<p></p>
</blockquote>
<h2>Dependencies</h2>
<ul>
<li><a href="https://github.com/keyboardio/Kaleidoscope-Ranges">Kaleidoscope-Ranges</a></li>
</ul>
<h2>Further reading</h2>
<p>Starting from the <a href="https://github.com/keyboardio/Kaleidoscope-TapDance/blob/master/examples/TapDance/TapDance.ino">example</a> is the recommended way of getting started with the plugin. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
